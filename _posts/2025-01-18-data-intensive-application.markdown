---
layout: post
title: "데이터 중심 애플리케이션 설계01"
date: 2025-01-18 21:57:01 +0900
categories: [ 독서, 데이터 중심 애플리케이션 설계01 ]
---

---

# 1장 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션

소프트웨어 시스템에서 중요한 3가지 관심사는 신뢰성, 확장성, 유지보수성 이다.

### 신뢰성

신뢰성은 무언가 잘못되더라도 지속적으로 올바르게 동작함을 의미한다. 잘못될 수 있는 일을 결함이라 하고, 이를 대처할 수 있는 시스템을 결함 내성 또는 탄력성을 지녔다고 한다.

### 확장성

확장성은 증가하는 부하에 대처하는 시스템 능력으로, 시스템이 커질 때 대처하기 위한 선택과, 추가 부하를 다루기 위한 계산 자원의 투입을 고려한다는 의미이다. 확장성을 설명하기 위해서는 부하에 따른 성능을 설명할 수 있어야 한다. 부하에 따른 시스템 성능으로는 처리량과 응답 시간을 고려해야 하고, 신뢰성을 유지할 수 있어야 한다.

### 유지보수성

소프트웨어 비용은 초기 개발이 아니라 지속해서 이어지는 유지보수에 들어간다. 이를 줄이기 위한 설계 원칙은 3가지다.
- 운용성 : 운영팀이 시스템을 원할하게 운영할 수 있게 만들어라
- 단순성 : 시스템에서 복잡도를 제거해 새로운 엔지니어가 시스템을 이해하기 쉽게 만들어라
- 발전성 : 엔지니어가 이후에 시스템을 쉽게 변경할 수 있게 하라

# 2장 데이터 모델과 질의 언어

데이터 모델은 소프트웨어가 어떻게 작성됐는지 뿐만 아니라 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 지대한 영향을 미친다.

## 문서 모델

Json 표현은 다중 테이블 스키마보다 나은 지역성을 갖는다. 이력서와 같은 경우, 관련 정보를 하나의 도큐먼트에 모을 수 있다. 애플리케이션의 데이터가 문서와 비슷한 일대다 관계 트리라면 문서 모델을 상요하는 것이 좋다.
하지만, 애플리케이션이 다대다 관계를 사용한다면 문서 모델은 불리하다.

### 문서 모델에서 스키마 유연성

쓰기 스키마와, 읽기 스키마가 분리되어 있다. RDB 와 다르게 스키마의 변경에 따른 마이그레이션이 필요 없다. 예전 문서를 읽은 경우를 처리하는 코드만 있어도 된다.

## 그래프형 데이터 모델

데이터에서 다대다 관계가 매우 일반적이라면, 그래프로 데이터를 모델링하는 것도 좋다. 그래프는 정점(vertex) 와 간선(edge) 로 이루어지며 데이터를 그래프로 모델링할 수 있다.

# 3장 저장소와 검색

데이터베이스는 추가 전용 데이터 파일인 로그를 활용해서 데이터를 다룬다.

## 색인

### 해시 색인

키를 데이터 파일의 바이트 오프셋에 매핑해, 인메모리 해시 맵을 유지하면 간단한 색인을 구현할 수 있다. 데이터는 세그먼트 단위로 나뉘어서 저장되며, 각 세그먼트는 키를 파일 오프셋에 매핑한 인메모리 해시 테이블을 갖기에, 키의 값을 찾을 수 있다.

### SS 테이블과 LSM 트리

키로 정렬된 문자열 테이블(SS 테이블)을 사용하면 해시 색인보다 장점이 있다. 일부 키에 대한 인메모리 색인만으로도 범위를 좁혀가며 탐색을 할 수 있기 때문이다.
<br/> 레드 블랙 트라니 AVL 트리를 사용하면, 임의 순서로 키를 삽입해도, 정렬된 순서로 해당 키를 읽을 수 있다. LSM 트리의 기본 개념은 백그라운드에서 연쇄적으로 SS 테이블을 병합하는 것이다.

### B 트리

가장 널리 사용되는 색인 구조다. 4KB 크기의 고정 크기 페이지로 데이터를 나눈다. 루트에서부터 하위 페이지를 탐색하면서 키를 찾을 수 있다. 키의 값을 갱신하려면 키를 포함하는 리프 페이지를 찾고, 페이지의 값을 바꾼 후에 디스크에 다시 기록해야 한다.

## 트랜잭션 처리

트랜잭션이 반드시 ACID 속성을 가질 필요는 없다. 트랜잭션 처리는 클라이언트가 지연시간이 낮은 읽기와 쓰기를 가능하게 한다는 의미다.
<br/> 트랜잭션 처리 시스템인 OLTP 는 질의당 적은 수의 레코드를 가져오며, 낮은 지연 시간이 목표다. 반면 분석 시스템인 OLAP 는 많은 레코드에 대한 집계를 목적으로 한다.

## 데이터 웨어하우징

OLTP 시스템에 비즈니스 분석가가 즉석 분석 질의를 하는 것은 OLTP 데이터베이스 전체 성능에 영향을 미칠 가능성이 있기에, 데이터 웨어하우스를 별도로 구성한다. OLTP 데이터베이스에서 ETL 을 거쳐서 웨어하우스에 데이터가 적재된다.


### OLTP 와 OLAP

OLTP 시스템은 대량의 요청에 대응하기 위해서 부하를 처리해야 하고, 질의마다 작은 수의 레코드만 다룬다. OLAP 시스템은 비즈니스 분석가가 사용하고, 적은 수의 질의를 다루지만 수백만 레코드를 스캔한다. 칼럼 지향 저장소를 사용해서 병목을 줄일 수 있다.

